{% extends "base.html" %}

{% block title %}{{ section.title }} - Panel Maestro{% endblock %}

{% block extra_css %}
<style>
    .section-header {
        background: linear-gradient(135deg, 
            {% if section.color_scheme == 'primary' %}#007bff, #0056b3{% endif %}
            {% if section.color_scheme == 'success' %}#28a745, #1e7e34{% endif %}
            {% if section.color_scheme == 'danger' %}#dc3545, #c82333{% endif %}
            {% if section.color_scheme == 'warning' %}#ffc107, #e0a800{% endif %}
            {% if section.color_scheme == 'info' %}#17a2b8, #138496{% endif %}
        );
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
    }
    
    .content-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
    }
    
    .content-item {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
        border-left: 4px solid #{{ section.color_scheme }};
    }
    
    .content-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
    }
    
    .data-table {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .table-header {
        background: #f8f9fa;
        padding: 1rem;
        border-bottom: 1px solid #dee2e6;
    }
    
    .error-message {
        background: #f8d7da;
        color: #721c24;
        padding: 1rem;
        border-radius: 8px;
        margin: 1rem 0;
        border: 1px solid #f5c6cb;
    }
    
    .config-required {
        background: #fff3cd;
        color: #856404;
        padding: 1rem;
        border-radius: 8px;
        margin: 1rem 0;
        border: 1px solid #ffeaa7;
    }
    
    .api-endpoint {
        background: #d4edda;
        padding: 0.5rem;
        border-radius: 4px;
        font-family: monospace;
        margin: 0.5rem 0;
    }
</style>
{% endblock %}

{% block content %}
<!-- Header de la Sección -->
<div class="section-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1>
                    <i class="fas {{ section.icon }} me-3"></i>
                    {{ section.title }}
                </h1>
                <p class="mb-0">{{ section.description }}</p>
            </div>
            <div class="col-md-4 text-end">
                <a href="{{ url_for('master_panel') }}" class="btn btn-outline-light">
                    <i class="fas fa-arrow-left"></i> Volver al Panel
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    <!-- Filtros y Controles -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="btn-group" role="group">
                {% if section.name == 'football' %}
                <a href="?type=tabla" class="btn btn-outline-primary {{ 'active' if content_type == 'tabla' else '' }}">
                    <i class="fas fa-table"></i> Tabla
                </a>
                <a href="?type=calendario" class="btn btn-outline-primary {{ 'active' if content_type == 'calendario' else '' }}">
                    <i class="fas fa-calendar"></i> Calendario
                </a>
                <a href="?type=estadisticas" class="btn btn-outline-primary {{ 'active' if content_type == 'estadisticas' else '' }}">
                    <i class="fas fa-chart-bar"></i> Estadísticas
                </a>
                {% elif section.name == 'movies' %}
                <a href="?type=popular" class="btn btn-outline-primary {{ 'active' if content_type == 'popular' else '' }}">
                    <i class="fas fa-fire"></i> Populares
                </a>
                <form class="d-inline-block ms-2" method="GET">
                    <input type="hidden" name="type" value="search">
                    <div class="input-group">
                        <input type="text" name="query" class="form-control" placeholder="Buscar películas..." 
                               value="{{ request.args.get('query', '') }}">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </form>
                {% elif section.name == 'music' %}
                <a href="?type=featured" class="btn btn-outline-primary {{ 'active' if content_type == 'featured' else '' }}">
                    <i class="fas fa-star"></i> Destacadas
                </a>
                <form class="d-inline-block ms-2" method="GET">
                    <input type="hidden" name="type" value="search">
                    <div class="input-group">
                        <input type="text" name="query" class="form-control" placeholder="Buscar música..." 
                               value="{{ request.args.get('query', '') }}">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </form>
                {% elif section.name == 'mod_apps' %}
                <a href="?type=popular" class="btn btn-outline-primary {{ 'active' if content_type == 'popular' else '' }}">
                    <i class="fas fa-download"></i> Populares
                </a>
                <form class="d-inline-block ms-2" method="GET">
                    <input type="hidden" name="type" value="search">
                    <div class="input-group">
                        <input type="text" name="query" class="form-control" placeholder="Buscar apps..." 
                               value="{{ request.args.get('query', '') }}">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </form>
                {% endif %}
            </div>
        </div>
        {% if session.is_admin %}
        <div class="col-md-4 text-end">
            <a href="{{ url_for('content_editor') }}?section={{ section.name }}" class="btn btn-success">
                <i class="fas fa-plus"></i> Agregar Contenido
            </a>
            <button class="btn btn-secondary" onclick="refreshContent()">
                <i class="fas fa-sync"></i> Actualizar
            </button>
        </div>
        {% endif %}
    </div>
    
    <!-- Contenido de la Sección -->
    {% if content_data.success %}
        {% if section.name == 'football' %}
            {% if content_type == 'tabla' %}
                <!-- Tabla de Posiciones -->
                <div class="data-table">
                    <div class="table-header">
                        <h5><i class="fas fa-trophy"></i> {{ content_data.liga }} - Tabla de Posiciones</h5>
                        <small class="text-muted">
                            Temporada {{ content_data.temporada }} | 
                            Actualizado: {{ content_data.ultima_actualizacion[:19] }}
                        </small>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Pos</th>
                                    <th>Equipo</th>
                                    <th>PJ</th>
                                    <th>PG</th>
                                    <th>PE</th>
                                    <th>PP</th>
                                    <th>GF</th>
                                    <th>GC</th>
                                    <th>DIF</th>
                                    <th>PTS</th>
                                    <th>EF%</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for equipo in content_data.equipos %}
                                <tr>
                                    <td><strong>{{ equipo.posicion }}</strong></td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <img src="{{ equipo.estadisticas.logo_url }}" 
                                                 alt="{{ equipo.nombre_corto }}" 
                                                 class="me-2" style="width: 24px; height: 24px;">
                                            <div>
                                                <strong>{{ equipo.nombre_corto }}</strong>
                                                <br>
                                                <small class="text-muted">{{ equipo.ciudad }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{ equipo.estadisticas.partidos_jugados }}</td>
                                    <td>{{ equipo.estadisticas.partidos_ganados }}</td>
                                    <td>{{ equipo.estadisticas.partidos_empatados }}</td>
                                    <td>{{ equipo.estadisticas.partidos_perdidos }}</td>
                                    <td>{{ equipo.estadisticas.goles_favor }}</td>
                                    <td>{{ equipo.estadisticas.goles_contra }}</td>
                                    <td class="{{ 'text-success' if equipo.estadisticas.diferencia_goles >= 0 else 'text-danger' }}">
                                        {{ equipo.estadisticas.diferencia_goles }}
                                    </td>
                                    <td><strong>{{ equipo.estadisticas.puntos }}</strong></td>
                                    <td>{{ equipo.estadisticas.efectividad }}%</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            {% endif %}
        {% elif section.name == 'movies' %}
            <!-- Contenido de Películas -->
            <div class="content-grid">
                {% for movie in content_data.data %}
                <div class="content-item">
                    <div class="row">
                        {% if movie.poster_path %}
                        <div class="col-md-4">
                            <img src="{{ movie.poster_path }}" class="img-fluid rounded" alt="{{ movie.title }}">
                        </div>
                        {% endif %}
                        <div class="col-md-{{ '8' if movie.poster_path else '12' }}">
                            <h5>{{ movie.title }}</h5>
                            <p class="text-muted">{{ movie.overview[:150] }}...</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-warning">
                                    <i class="fas fa-star"></i> {{ movie.vote_average }}
                                </span>
                                <small class="text-muted">{{ movie.release_date }}</small>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% elif section.name == 'music' %}
            <!-- Contenido de Música -->
            <div class="content-grid">
                {% for item in content_data.data %}
                <div class="content-item">
                    <div class="row">
                        {% if item.image %}
                        <div class="col-md-4">
                            <img src="{{ item.image }}" class="img-fluid rounded" alt="{{ item.name }}">
                        </div>
                        {% endif %}
                        <div class="col-md-{{ '8' if item.image else '12' }}">
                            <h5>{{ item.name }}</h5>
                            <p class="text-muted">{{ item.description or 'Playlist de Spotify' }}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                {% if 'tracks_total' in item %}
                                <span class="badge bg-info">
                                    <i class="fas fa-music"></i> {{ item.tracks_total }} tracks
                                </span>
                                {% endif %}
                                <a href="{{ item.external_url }}" target="_blank" class="btn btn-sm btn-success">
                                    <i class="fab fa-spotify"></i> Abrir
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% elif section.name == 'mod_apps' %}
            <!-- Contenido de Apps Modificadas -->
            <div class="content-grid">
                {% for app in content_data.data %}
                <div class="content-item">
                    <div class="row">
                        {% if app.icon_url %}
                        <div class="col-md-3">
                            <img src="{{ app.icon_url }}" class="img-fluid rounded" alt="{{ app.name }}" style="max-width: 64px;">
                        </div>
                        {% endif %}
                        <div class="col-md-{{ '9' if app.icon_url else '12' }}">
                            <h5>{{ app.name }}</h5>
                            <p class="text-muted">{{ app.description }}</p>
                            <div class="mb-2">
                                <span class="badge bg-primary">{{ app.category }}</span>
                                <span class="badge bg-success">{{ app.version }}</span>
                                <span class="badge bg-info">{{ app.size }}</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <small class="text-muted">
                                        <i class="fas fa-download"></i> {{ app.downloads }}
                                        <i class="fas fa-star ms-2"></i> {{ app.rating }}
                                    </small>
                                </div>
                                <a href="{{ app.download_url }}" target="_blank" class="btn btn-sm btn-primary">
                                    <i class="fas fa-download"></i> Descargar
                                </a>
                            </div>
                            <div class="mt-2">
                                <small><strong>Modificaciones:</strong></small>
                                {% for mod in app.modifications %}
                                <span class="badge bg-light text-dark me-1">{{ mod }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% endif %}
    {% elif content_data.get('configuration_required') %}
        <!-- Configuración Requerida -->
        <div class="config-required">
            <h5><i class="fas fa-exclamation-triangle"></i> Configuración Requerida</h5>
            <p>{{ content_data.error }}</p>
            {% if section.name == 'movies' %}
            <p>Para usar esta sección, necesitas configurar tu API key de The Movie Database (TMDB):</p>
            <ol>
                <li>Regístrate en <a href="https://www.themoviedb.org/" target="_blank">themoviedb.org</a></li>
                <li>Obtén tu API key</li>
                <li>Agrega la API key en el panel de administración</li>
            </ol>
            {% elif section.name == 'music' %}
            <p>Para usar esta sección, necesitas configurar las credenciales de Spotify:</p>
            <ol>
                <li>Regístrate en <a href="https://developer.spotify.com/" target="_blank">Spotify for Developers</a></li>
                <li>Crea una aplicación y obtén Client ID y Client Secret</li>
                <li>Agrega las credenciales en el panel de administración</li>
            </ol>
            {% endif %}
            {% if session.is_admin %}
            <a href="{{ url_for('admin') }}" class="btn btn-primary">
                <i class="fas fa-cog"></i> Configurar API Keys
            </a>
            {% endif %}
        </div>
    {% else %}
        <!-- Error -->
        <div class="error-message">
            <h5><i class="fas fa-exclamation-circle"></i> Error</h5>
            <p>{{ content_data.error }}</p>
        </div>
    {% endif %}
    
    <!-- Información de API (si aplica) -->
    {% if section.name in ['football', 'transmissions'] and current_user %}
    <div class="card mt-4">
        <div class="card-header">
            <h6><i class="fas fa-code"></i> Acceso por API</h6>
        </div>
        <div class="card-body">
            <p>Puedes acceder a estos datos programáticamente usando tu API key:</p>
            <div class="api-endpoint">
                GET {{ request.url_root }}api/content/{{ section.name }}?key={{ current_user.api_key }}
            </div>
            <button class="btn btn-sm btn-outline-primary" onclick="copyApiUrl()">
                <i class="fas fa-copy"></i> Copiar URL
            </button>
        </div>
    </div>
    {% endif %}
</div>

<script>
function refreshContent() {
    location.reload();
}

function copyApiUrl() {
    const apiUrl = `{{ request.url_root }}api/content/{{ section.name }}?key={{ current_user.api_key if current_user else '' }}`;
    navigator.clipboard.writeText(apiUrl).then(() => {
        alert('URL de API copiada al portapapeles');
    });
}
</script>
{% endblock %}